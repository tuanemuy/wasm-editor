# ドメイン設計

## 概要

本アプリケーションは、DDDの原則に基づき、以下の6つのドメインで構成されます。
各ドメインは明確な責務を持ち、ヘキサゴナルアーキテクチャに従って実装されます。

## ドメイン一覧

### 1. Note（メモ）

**責務**: メモの作成、編集、削除、閲覧、検索を管理する中核ドメイン

- **エンティティ**: メモ本体
- **主要な操作**:
  - メモの作成・更新・削除
  - メモの取得（単一・一覧）
  - 全文検索
  - タグによる検索
  - Markdownエクスポート
- **関連するドメイン**: Tag（タグ解析）、Revision（履歴保存）、Image（画像参照）

### 2. Tag（タグ）

**責務**: メモからのタグ自動解析とタグベースのフィルタリング

- **エンティティ**: タグ
- **主要な操作**:
  - メモ本文からのタグ自動解析
  - タグ一覧の取得
  - タグの使用回数カウント
- **関連するドメイン**: Note（メモとの関連付け）

### 3. Revision（リビジョン）

**責務**: メモの変更履歴の保存と復元

- **エンティティ**: リビジョン（メモのスナップショット）
- **主要な操作**:
  - リビジョンの作成
  - リビジョン一覧の取得
  - 特定リビジョンの取得
  - リビジョンからの復元
- **関連するドメイン**: Note（履歴対象）

### 4. Database（データベース）

**責務**: データベースファイルの管理と接続

- **エンティティ**: データベース接続
- **主要な操作**:
  - DBファイルのオープン
  - 新規DBファイルの作成
  - DBパスの取得・変更
  - 接続状態の管理
- **外部システム**: File System Access API

### 5. Image（画像）

**責務**: 画像のアップロードとローカルストレージ管理

- **エンティティ**: 画像ファイル
- **主要な操作**:
  - 画像のアップロード
  - 画像の保存
  - 画像URLの取得
  - 画像サイズのバリデーション
- **外部システム**: File System Access API
- **関連するドメイン**: Note（画像参照）

### 6. Settings（設定）

**責務**: アプリケーション全体の設定管理

- **エンティティ**: 設定情報
- **主要な操作**:
  - 設定の取得
  - 設定の更新
- **設定項目**:
  - デフォルトソート順
  - 自動保存間隔
  - リビジョン保存間隔
  - エディター設定（フォントサイズ、テーマ）

## ドメイン間の関係

```
Note (中核)
├── Tag (タグ解析・参照)
├── Revision (履歴保存)
└── Image (画像参照)

Database (基盤)
└── すべてのドメインが依存

Settings (横断的関心事)
└── すべてのドメインに影響
```

## アーキテクチャ方針

### ヘキサゴナルアーキテクチャ

各ドメインは以下の3層で構成されます：

1. **Domain Layer** (`app/core/domain/${domain}/`)
   - エンティティ、値オブジェクト
   - ビジネスルールとバリデーション
   - ポートインターフェース（リポジトリ、外部サービス）

2. **Application Layer** (`app/core/application/${domain}/`)
   - ユースケース実装
   - ドメインロジックの組み合わせ
   - トランザクション境界

3. **Adapter Layer** (`app/core/adapters/`)
   - ポートの具体的実装
   - 外部システムとの接続（DB、File System Access API等）

### 依存関係の方向

```
Presentation Layer (React Router)
        ↓
Application Layer (Use Cases)
        ↓
Domain Layer (Business Logic)
        ↑
Adapter Layer (Infrastructure)
```

- ドメイン層は他の層に依存しない
- アダプター層はドメイン層のポートを実装
- アプリケーション層がドメインとアダプターを統合

## 次のステップ

各ドメインの詳細設計は以下のファイルに記載されています：

- [Note ドメイン](./note.md)
- [Tag ドメイン](./tag.md)
- [Revision ドメイン](./revision.md)
- [Database ドメイン](./database.md)
- [Image ドメイン](./image.md)
- [Settings ドメイン](./settings.md)

# ドメイン区分

## 概要

本アプリケーションは、DDDの原則に基づき、以下の6つのドメインに区分されます。
各ドメインは明確な責務を持ち、疎結合で高凝集な設計を実現します。

## ドメイン一覧

### 1. Note（ノート）ドメイン

**責務**: ノートの作成、更新、削除、取得、検索、フィルタリング、ソート、およびタグの自動解析と管理

**主要なビジネスロジック**:
- ノートのライフサイクル管理
- ノート本文からのタグ自動解析（`#タグ名` 形式）
- ノートの検索（全文検索、タグ検索、複合検索）
- ノートのソート（作成日/更新日、昇順/降順）
- タグによるノートのフィルタリング（複数タグのAND検索）

**関連する機能要件**:
- FR-MEMO-001〜010（メモの作成、編集、削除、閲覧）
- FR-TAG-001〜009（タグの自動解析、一覧、フィルタリング）
- FR-HOME-001〜009（メモ一覧表示、無限スクロール、ソート）
- FR-SEARCH-001〜007（全文検索、タグ検索、複合検索）

**詳細**: [Note.md](./Note.md)

---

### 2. Revision（リビジョン）ドメイン

**責務**: ノートの変更履歴の保存、取得、復元

**主要なビジネスロジック**:
- ノートのスナップショット保存
- リビジョンの保存タイミング制御（手動保存時、一定時間ごと、ノートを閉じた時）
- リビジョン履歴の管理
- 過去のリビジョンへの復元

**関連する機能要件**:
- FR-DATA-007〜011（リビジョン管理）

**詳細**: [Revision.md](./Revision.md)

---

### 3. Asset（アセット）ドメイン

**責務**: 画像などのファイル資産の管理

**主要なビジネスロジック**:
- 画像のアップロード処理
- 画像のローカルファイルシステムへの保存
- 画像のサイズ制限（10MB以下）
- 画像の参照管理（ノートとの関連付け）

**関連する機能要件**:
- FR-EDITOR-006〜009（画像管理）

**詳細**: [Asset.md](./Asset.md)

---

### 4. Export（エクスポート）ドメイン

**責務**: ノートのエクスポート（Markdown、PDF）

**主要なビジネスロジック**:
- ノートをMarkdownファイルに変換
- ノートをPDFファイルに変換（Markdownのレンダリング、画像の埋め込み）
- エクスポートファイル名の生成（タイトルまたは作成日時）
- 複数ノートの一括エクスポート

**関連する機能要件**:
- FR-EXPORT-001〜007（Markdownエクスポート、PDFエクスポート）

**詳細**: [Export.md](./Export.md)

---

### 5. Database（データベース）ドメイン

**責務**: データベース接続とDBファイルの管理

**主要なビジネスロジック**:
- DBファイルの作成、オープン、クローズ
- DBファイルパスの管理
- データベース接続状態の管理
- DBファイルのインポート/エクスポート

**関連する機能要件**:
- FR-DATA-001〜003（ローカルデータベース）

**詳細**: [Database.md](./Database.md)

---

### 6. Settings（設定）ドメイン

**責務**: アプリケーション設定の管理

**主要なビジネスロジック**:
- デフォルトソート順の管理
- エディター設定の管理（フォントサイズ、テーマ）
- 自動保存間隔の管理
- リビジョン保存間隔の管理
- 設定の永続化

**詳細**: [Settings.md](./Settings.md)

---

## ドメイン間の関係

```
┌─────────────┐
│   Note      │───┐
└─────────────┘   │
                  │
┌─────────────┐   │    ┌─────────────┐
│  Revision   │───┼────│  Database   │
└─────────────┘   │    └─────────────┘
                  │
┌─────────────┐   │
│   Asset     │───┤
└─────────────┘   │
                  │
┌─────────────┐   │
│   Export    │───┤
└─────────────┘   │
                  │
┌─────────────┐   │
│  Settings   │───┘
└─────────────┘
```

- すべてのドメインは `Database` ドメインを通じてデータを永続化します
- `Revision` ドメインは `Note` ドメインのスナップショットを管理します
- `Export` ドメインは `Note` と `Asset` のデータを使用してエクスポートを行います
- `Settings` ドメインは他のドメインの動作を制御する設定値を提供します

## アーキテクチャの原則

### ヘキサゴナルアーキテクチャ

各ドメインは以下の構造を持ちます：

```
app/core/
├── domain/
│   └── ${domain}/
│       ├── entity.ts           # エンティティ
│       ├── valueObject.ts      # 値オブジェクト
│       └── ports/              # ポート（インターフェース）
│           └── **.ts
├── adapters/
│   └── ${adapterName}/         # アダプター（具象実装）
│       └── **.ts
└── application/
    ├── context.ts              # コンテキスト（DI）
    └── ${domain}/
        └── ${usecase}.ts       # ユースケース
```

### 依存関係のルール

1. **Domain層**: 他の層に依存しない（最も内側）
2. **Application層**: Domain層のみに依存
3. **Adapter層**: Domain層とApplication層に依存可能（最も外側）
4. **依存性逆転**: 外部サービス（DB、File System等）への依存は、Domain層でポート（インターフェース）として定義し、Adapter層で具象実装を提供

### エラーハンドリング

- すべてのバックエンド関数は `Result<T, E>` または `Promise<Result<T, E>>` を返す（neverthrow使用）
- エラー型は各層ごとに定義：
  - `app/core/error/domain.ts`: Domain層のエラー
  - `app/core/error/adapter.ts`: Adapter層のエラー
  - `app/core/error/application.ts`: Application層のエラー

---

## 次のステップ

各ドメインの詳細設計は、以下のファイルで定義します：

1. [Note.md](./Note.md)
2. [Revision.md](./Revision.md)
3. [Asset.md](./Asset.md)
4. [Export.md](./Export.md)
5. [Database.md](./Database.md)
6. [Settings.md](./Settings.md)

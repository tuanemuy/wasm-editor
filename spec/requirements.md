# 機能要件定義

## 1. システム概要

### 1.1 システム種別
- Single Page Application (SPA)
- オフラインファースト設計
- ログイン・認証機能なし（ローカル専用）

## 2. メモ管理機能

### 2.1 メモの作成
- **FR-MEMO-001**: ユーザーは新規メモを作成できること
- **FR-MEMO-002**: メモは以下の属性を持つこと
  - ID（自動生成）
  - 本文（Markdown形式）
  - 作成日時（自動記録）
  - 更新日時（自動更新）
  - タグリスト（自動解析）
- **FR-MEMO-003**: メモ作成時は即座にDBに保存されること

### 2.2 メモの編集
- **FR-MEMO-004**: ユーザーは既存メモを編集できること
- **FR-MEMO-005**: 編集中のメモは自動保存されること
- **FR-MEMO-006**: 自動保存のタイミングは以下の通り
  - 編集停止後、一定時間（例: 2秒）経過後
  - エディタからフォーカスが外れた時
  - ページ遷移時

### 2.3 メモの削除
- **FR-MEMO-007**: ユーザーはメモを削除できること
- **FR-MEMO-008**: 削除時は確認ダイアログを表示すること

### 2.4 メモの閲覧
- **FR-MEMO-009**: ユーザーはメモの詳細を閲覧できること
- **FR-MEMO-010**: 閲覧モードと編集モードを切り替えられること

## 3. エディタ機能

### 3.1 リッチテキスト編集
- **FR-EDITOR-001**: Tiptapを使用したリッチテキスト編集が可能であること
- **FR-EDITOR-002**: 以下のフォーマット機能を提供すること
  - 見出し（H1〜H6）
  - 太字、斜体、下線、打ち消し線
  - リスト（順序あり・なし）
  - 引用
  - コードブロック
  - リンク
  - 画像

### 3.2 Markdown対応
- **FR-EDITOR-003**: メモはMarkdown形式で保存されること
- **FR-EDITOR-004**: Markdownシンタックスでの入力が可能であること
- **FR-EDITOR-005**: リッチテキスト編集とMarkdown入力は相互変換可能であること

### 3.3 画像管理
- **FR-EDITOR-006**: ユーザーは画像をローカルからアップロードできること
- **FR-EDITOR-007**: アップロードされた画像はローカルファイルシステムに保存されること
- **FR-EDITOR-008**: 画像はメモに埋め込み表示されること
- **FR-EDITOR-009**: 画像のサイズは適切に制限されること（例: 10MB以下）

## 4. データ永続化機能

### 4.1 ローカルデータベース
- **FR-DATA-001**: DBファイルはローカルファイルシステムに保存されること
- **FR-DATA-002**: ユーザーは任意の場所にDBファイルを保存できること
- **FR-DATA-003**: アプリケーション起動時に既存のDBファイルを開けること

### 4.2 自動保存
- **FR-DATA-004**: メモの変更は自動的に保存されること
- **FR-DATA-005**: 保存状態をユーザーに通知すること（例: "保存済み"、"保存中"）
- **FR-DATA-006**: 保存失敗時はエラーメッセージを表示すること

### 4.3 リビジョン管理
- **FR-DATA-007**: メモの変更履歴（リビジョン）を保存すること
- **FR-DATA-008**: ユーザーは過去のリビジョンを閲覧できること
- **FR-DATA-009**: ユーザーは過去のリビジョンに戻すことができること
- **FR-DATA-010**: リビジョンは以下の情報を含むこと
  - リビジョンID
  - 保存日時
  - メモの内容（スナップショット）
- **FR-DATA-011**: リビジョンの保存タイミングは以下の通り
  - 手動保存時
  - 一定時間ごと（例: 10分）
  - メモを閉じた時

## 5. ホーム画面（一覧表示）機能

### 5.1 メモ一覧表示
- **FR-HOME-001**: ホーム画面にメモの一覧を表示すること
- **FR-HOME-002**: 各メモは以下の情報を表示すること
  - Markdownプレビュー（一部・はみ出す部分はグラデーションで隠す）
  - 作成日時または更新日時
  - タグ
- **FR-HOME-003**: メモ一覧はSNSのタイムライン風に表示されること

### 5.2 無限スクロール
- **FR-HOME-004**: メモ一覧は無限スクロールで表示されること
- **FR-HOME-005**: スクロールに応じて追加のメモを段階的に読み込むこと
- **FR-HOME-006**: 初回表示時は一定件数（例: 20件）を読み込むこと

### 5.3 ソート機能
- **FR-HOME-007**: メモ一覧のソート順を切り替えられること
- **FR-HOME-008**: 以下のソート順をサポートすること
  - 作成日順（新しい順・古い順）
  - 更新日順（新しい順・古い順）
- **FR-HOME-009**: ソート順の設定はDBに保存され、次回起動時にも適用されること

## 6. タグ機能

### 6.1 タグの自動解析
- **FR-TAG-001**: メモ本文からタグを自動的に解析すること
- **FR-TAG-002**: タグは以下の形式で記述すること: `#タグ名`
- **FR-TAG-003**: タグ名は以下のルールに従うこと
  - 英数字、ひらがな、カタカナ、漢字を使用可能
  - スペースを含まない
  - 特殊文字は使用不可（ハイフン、アンダースコアは可）
- **FR-TAG-004**: 解析されたタグはDBに保存されること

### 6.2 タグ一覧
- **FR-TAG-005**: すべてのタグの一覧を表示できること
- **FR-TAG-006**: タグ一覧には各タグの使用回数を表示すること

### 6.3 タグによるフィルタリング
- **FR-TAG-007**: タグをクリックすることで、そのタグを含むメモを絞り込めること
- **FR-TAG-008**: 複数のタグを選択してAND検索できること
- **FR-TAG-009**: タグフィルタは解除できること

## 7. 検索機能

### 7.1 全文検索
- **FR-SEARCH-001**: メモの全文検索が可能であること
- **FR-SEARCH-002**: 検索対象は以下の通り
  - 本文
- **FR-SEARCH-003**: 検索結果はリアルタイムに更新されること
- **FR-SEARCH-004**: 検索キーワードはハイライト表示されること

### 7.2 タグ検索
- **FR-SEARCH-005**: タグによる検索が可能であること
- **FR-SEARCH-006**: 複数タグによるAND検索が可能であること

### 7.3 複合検索
- **FR-SEARCH-007**: 全文検索とタグ検索を組み合わせて使用できること

## 8. エクスポート機能

### 8.1 Markdownエクスポート
- **FR-EXPORT-001**: メモをMarkdownファイルとしてエクスポートできること
- **FR-EXPORT-002**: エクスポートされたファイル名は以下の形式とすること: `{タイトル}.md` または `{作成日時}.md`
- **FR-EXPORT-003**: 複数のメモを一括エクスポートできること

### 8.2 PDFエクスポート
- **FR-EXPORT-004**: メモをPDFファイルとしてエクスポートできること
- **FR-EXPORT-005**: PDFはMarkdownを適切にレンダリングした状態でエクスポートされること
- **FR-EXPORT-006**: 複数のメモを一括エクスポートできること
- **FR-EXPORT-007**: PDFには以下の情報を含めること
  - タイトル（本文から自動抽出）
  - 作成日時・更新日時
  - メモ本文（フォーマット済み）
  - 画像（埋め込み）
